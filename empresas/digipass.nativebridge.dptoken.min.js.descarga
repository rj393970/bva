/**
 * Copyright (c) since 2018. OneSpan Inc.
 * All rights reserved. https://www.onespan.com
 *
 * @license OneSpan Inc.
 */
var digipass=digipass||{};digipass.nativebridge=digipass.nativebridge||{};digipass.nativebridge.DPToken=function(){"use strict";var e;var i;var n;this.version="2.7.4";this.versionCode=20704;this.useFallback=function(){n=false};this.onReady=function(i){e=i;return this};this.onError=function(e){i=e;return this};this.close=function(){if(o)o.close()};this.reconnect=function(){c()};this.isReady=function(){return o&&o.readyState==1};this.isFallback=function(){return s};this.getNativeBridgeVersion=function(e){l("core.getNativeBridgeVersion",{},e)};this.getNativeBridgeAttributes=function(e){l("core.getNativeBridgeAttributes",{},e)};var t=this;var o;var s=false;var a={};var r={};var f=false;if(!digipass.nativebridge.config&&!digipass.nativebridge.config_ext)throw"The configuration file 'digipass.nativebridge.config.min.js' has not been loaded";t.useFallback();c();function c(){f=false;if(sessionStorage){if(sessionStorage.wssPort){try{h(sessionStorage.wssPort,function(e){if(!e){sessionStorage.clear();return}o=e;o.onclose=function(){o=null;if(f){f=false;setTimeout(c,3e3)}else if(i)i(t)};o.onerror=function(){o.close()};o.onmessage=function(e){d(JSON.parse(e.data))};P()});setTimeout(u,3e3)}catch(e){sessionStorage.clear()}}else if(sessionStorage.wsPort&&n==true){try{S(sessionStorage.wsPort,function(e){if(!e){sessionStorage.clear();return}o=e;o.onclose=function(){o=null;if(f){f=false;setTimeout(c,3e3)}else if(i)i(t)};o.onerror=function(){o.close()};o.onmessage=function(e){d(JSON.parse(e.data))};P()});setTimeout(u,3e3)}catch(e){sessionStorage.clear()}}else{u()}}else{u()}}function u(){if(!o){v(function(e){if(!e){if(n==true){p(function(e){if(!e){if(i)i(t);return}o=e;o.onclose=function(){o=null;if(f){f=false;setTimeout(c,3e3)}else if(i)i(t)};o.onerror=function(){o.close()};o.onmessage=function(e){d(JSON.parse(e.data))};P()})}else{if(i)i(t);return}}else{o=e;o.onclose=function(){o=null;if(f){f=false;setTimeout(c,3e3)}else if(i)i(t)};o.onerror=function(){o.close()};o.onmessage=function(e){d(JSON.parse(e.data))};P()}})}}function g(){f=false;if(e)e(t)}function l(e,i,n){if(!t.isReady()){console.log("[digipass-native-bridge] Request aborted, the bridge is not yet ready.");return}var s=Math.ceil(Math.random()*920704+120704).toString();a[s]=n;var r={type:"request",id:s,api:e,data:i};o.send(JSON.stringify(r))}function d(e){if(e.data&&e.data.integrationError){var i="[digipass-native-bridge] Integration error: ";console.log(i+e.data.integrationError)}if(e.type=="response"){var n=a[e.id];if(!n)return;delete a[e.id];n(e.data)}if(e.type=="event"){var n=r[e.event];if(!n)return;n(e.data)}}function v(e){var i=["42579","35739","36811","39582","45250","46028"];var n;if(localStorage){n=localStorage.getItem("digipass.nativebridge.preferredSecurePort")}if(n){var t=i.indexOf(n);if(t>0){i.splice(t,1);i.unshift(n)}}h(i[0],function(n){if(n){e(n);return}var t=1;var o=false;for(var s=1;s<i.length;++s){(function(n){h(i[n],function(s){if(s){if(localStorage){localStorage.setItem("digipass.nativebridge.preferredSecurePort",i[n])}e(s);o=true}if(++t==i.length&&!o){e()}})})(s)}})}function p(e){var i=["42580","35740","36812","39583","45251","46029"];var n;if(localStorage){n=localStorage.getItem("digipass.nativebridge.preferredFallbackPort")}if(n){var t=i.indexOf(n);if(t>0){i.splice(t,1);i.unshift(n)}}S(i[0],function(n){if(n){e(n);return}var t=1;var o=false;for(var s=1;s<i.length;++s){(function(n){S(i[n],function(s){if(s){if(localStorage){localStorage.setItem("digipass.nativebridge.preferredFallbackPort",i[n])}e(s);o=true}if(++t==i.length&&!o){e()}})})(s)}})}function h(e,i){var n=null;var t=false;try{n=new WebSocket("wss://localhost.vdsnb.com:"+e)}catch(o){a();throw o}n.onmessage=function(o){if(o.data=="Hello from DIGIPASS Native Bridge!"){t=true;if(sessionStorage){sessionStorage.wssPort=e}s=false;i(n)}};n.onopen=function(){setTimeout(a,1e3)};n.onerror=function(){a()};n.onclose=function(){a()};if(navigator.userAgent.indexOf("Firefox")!=-1)setTimeout(a,17500);else setTimeout(a,5e3);function a(){if(!t){t=true;if(n)n.close();i()}}}function S(e,i){var n=null;var t=false;try{n=new WebSocket("ws://127.0.0.1:"+e)}catch(o){a();throw o}n.onmessage=function(o){if(o.data=="Hello from DIGIPASS Native Bridge!"){t=true;s=true;if(sessionStorage){sessionStorage.wsPort=e}i(n)}};n.onopen=function(){setTimeout(a,1e3)};n.onerror=function(){a()};n.onclose=function(){a()};if(navigator.userAgent.indexOf("Firefox")!=-1)setTimeout(a,17500);else setTimeout(a,5e3);function a(){if(!t){t=true;if(n)n.close();i()}}}function P(){var e=digipass.nativebridge.config;var i=digipass.nativebridge.config_ext;var n={};var t={};if(e&&e.data||i&&i.data){if(e&&e.data){var o=e.data.indexOf("\n");var s=parseInt(e.data.substring(0,o));n.version=s;t.data=e.data}if(i&&i.data){var o=i.data.indexOf("\n");var s=parseInt(i.data.substring(0,o));n.version_ext=s;t.data_ext=i.data}l("core.updateConfig",n,function(e){if(e.updateNeeded){f=true;l("core.updateConfig",t,function(){g()})}else{g()}})}else{g()}}function m(){if(o){o.onclose=function(){};if(navigator.userAgent.indexOf("Safari/")!=-1){o.close();o=null}}}window.addEventListener("unload",m);window.addEventListener("pagehide",m);window.addEventListener("beforeunload",function(){});this.initializeDigipass=function(e,i){var n={digipassSerial:e};l("dptoken.initializeDigipass",n,i)};this.getDigipassList=function(e){var i={};l("dptoken.getDigipassList",i,function(i){e(i)})};this.getDigipassProperty=function(e,i){var n={propertyId:e};l("dptoken.getDigipassProperty",n,function(e){i(e)})};this.setDigipassLang=function(e,i){var n={langId:e};l("dptoken.setDigipassLang",n,function(e){i(e)})};this.generateResponseOnlyOTP=function(e,i){var n={cryptoAppIndex:e};l("dptoken.generateResponseOnlyOTP",n,function(e){i(e)})};this.getDigipassTimeChallenge=function(e){var i={};l("dptoken.getDigipassTimeChallenge",i,function(i){e(i)})};this.initiatePinChange=function(e){var i={};l("dptoken.initiatePinChange",i,function(i){e(i)})};this.getPinUnlockChallenge=function(e){var i={};l("dptoken.getPinUnlockChallenge",i,function(i){e(i)})};this.setPinUnlockResponse=function(e,i){var n={unlockResponse:e};l("dptoken.setPinUnlockResponse",n,function(e){i(e)})};this.transmitRequestMessage=function(e,i){var n={requestMessage:e};l("dptoken.transmitRequestMessage",n,function(e){i(e)})};this.parseResponseMessage=function(e,i,n){var t={requestMessage:i,responseMessage:e};l("dptoken.parseResponseMessage",t,function(e){n(e)})};this.DPBBInitializePairing=function(e){var i={};l("dptoken.DPBBInitializePairing",i,function(i){e(i)})};this.DPBBFinalizePairing=function(e){var i={};l("dptoken.DPBBFinalizePairing",i,function(i){e(i)})};this.DPBBRemovePairings=function(e){var i={};l("dptoken.DPBBRemovePairings",i,function(i){e(i)})};this.abort=function(e,i){var n={digipassSerial:e};l("dptoken.abort",n,function(e){i(e)})}};
//# sourceMappingURL=digipass.nativebridge.dptoken.min.map